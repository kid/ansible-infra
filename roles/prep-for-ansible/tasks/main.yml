---
- name: Prepare host for ansible
  block:
    - name: Install sudo
      apt:
        name: sudo
        state: present
        cache_valid_time: 86400

    - name: Add ansible user
      user:
        name: ansible
        uid: 1100
        password_lock: true
        shell: /bin/bash

    - name: Add authorized keys for user "ansible"
      ansible.posix.authorized_key:
        user: ansible
        state: present
        key: https://github.com/kid.keys

    - name: Add user "ansible" to sudo
      lineinfile:
        path: /etc/sudoers.d/ansible
        line: 'ansible ALL=(ALL) NOPASSWD: ALL'
        state: present
        mode: 0640
        create: true
        validate: 'visudo -cf %s'
